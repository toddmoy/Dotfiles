var Lt=Object.create,D=Object.defineProperty,Ut=Object.getPrototypeOf,Dt=Object.prototype.hasOwnProperty,Jt=Object.getOwnPropertyNames,Ft=Object.getOwnPropertyDescriptor;var we=e=>D(e,"__esModule",{value:!0});var c=(e,r)=>()=>(r||(r={exports:{}},e(r.exports,r)),r.exports),Gt=(e,r)=>{we(e);for(var n in r)D(e,n,{get:r[n],enumerable:!0})},Mt=(e,r,n)=>{if(we(e),r&&typeof r=="object"||typeof r=="function")for(let t of Jt(r))!Dt.call(e,t)&&t!=="default"&&D(e,t,{get:()=>r[t],enumerable:!(n=Ft(r,t))||n.enumerable});return e},B=e=>e&&e.__esModule?e:Mt(D(e!=null?Lt(Ut(e)):{},"default",{value:e,enumerable:!0}),e);var b=c((Ci,me)=>{me.exports=function(r,n,t){r(n),t&&t(n===!0?null:n)}});var J=c((Ni,_e)=>{"use strict";var Ee=b();_e.exports=function(r,n){if(!r)return function(u,i){return u?Ee(i,u,n):i(!0)};Array.isArray(r)||(r=Object.keys(r).map(function(u){return r[u]}));var t=0;return function(u,i){if(u)return Ee(i,u,n);t>=r.length?i(!0):i(null,r[t++])}}});var Se=c((Ii,ke)=>{"use strict";var Ht=J();ke.exports=function(e){return Ht(Object.keys(e))}});var ee=c((Ri,Be)=>{"use strict";var Yt=b();Be.exports=function(r,n){return function(t,u){if(t)return Yt(u,t,n);if(r!=null){var i=r;r=null,u(null,i)}else u(!0)}}});var Oe=c((Li,Pe)=>{"use strict";Pe.exports=function(r){var n=0;return r=r||Infinity,function(t,u){if(t)return u&&u(t);if(n>r)return u(!0);u(null,n++)}}});var Te=c((Ui,Ae)=>{"use strict";Ae.exports=function(r){return r=r||Math.random,function(n,t){return n?t&&t(n):t(null,r())}}});var Ne=c((Di,Ce)=>{"use strict";Ce.exports=function(){return function(r,n){n(!0)}}});var Re=c((Ji,Ie)=>{"use strict";Ie.exports=function(r){return function(n,t){t(r)}}});var Ue=c((Fi,Le)=>{"use strict";Le.exports={keys:Se(),once:ee(),values:J(),count:Oe(),infinite:Te(),empty:Ne(),error:Re()}});var P=c((Gi,De)=>{"use strict";De.exports=function(r,n){var t,u;function i(f){if(t=f,u)return i.abort();(function s(){for(var o=!0,l=!1;o;)if(l=!1,t(null,function(a,p){if(l=!0,a=a||u){if(o=!1,n)n(a===!0?null:a);else if(a&&a!==!0)throw a}else r&&r(p)===!1||u?(o=!1,t(u||!0,n||function(){})):o||s()}),!l){o=!1;return}})()}return i.abort=function(f,s){if(typeof f=="function"&&(s=f,f=!0),u=f||!0,t)return t(u,s||function(){})},i}});var Fe=c((Mi,Je)=>{"use strict";var Kt=P();Je.exports=function(r){return Kt(null,r)}});var Me=c((Hi,Ge)=>{"use strict";var Wt=P();Ge.exports=function(r){return Wt(function(n){console.log(n)},r)}});var O=c((Yi,He)=>{He.exports=function(r){return r&&(typeof r=="string"?function(n){return n[r]}:typeof r=="object"&&typeof r.exec=="function"?function(n){var t=r.exec(n);return t&&t[0]}:r)}});var We=c((Ki,Ye)=>{"use strict";function Ke(e){return e}var Qt=O(),$t=P();Ye.exports=function(r,n){var t=!1;return n?r=Qt(r)||Ke:(n=r,r=Ke),$t(function(u){if(r(u))return t=!0,n(null,u),!1},function(u){t||n(u===!0?null:u,null)})}});var F=c((Wi,Qe)=>{"use strict";var zt=P();Qe.exports=function(r,n,t){t||(t=n,n=null);var u=zt(function(i){n=r(n,i)},function(i){t(i,n)});return arguments.length===2?function(i){i(null,function(f,s){if(f)return t(f===!0?null:f);n=s,u(i)})}:u}});var ze=c((Qi,$e)=>{"use strict";var Vt=F();$e.exports=function(r){return Vt(function(n,t){return n.push(t),n},[],r)}});var Xe=c(($i,Ve)=>{"use strict";var Xt=F();Ve.exports=function(r){return Xt(function(n,t){return n+t},"",r)}});var je=c((zi,Ze)=>{"use strict";Ze.exports={drain:P(),onEnd:Fe(),log:Me(),find:We(),reduce:F(),collect:ze(),concat:Xe()}});var er=c((Vi,be)=>{"use strict";function Zt(e){return e}var jt=O();be.exports=function(r){return r?(r=jt(r),function(n){return function(t,u){n(t,function(i,f){try{f=i?null:r(f)}catch(s){return n(s,function(){return u(s)})}u(i,f)})}}):Zt}});var nr=c((Xi,rr)=>{"use strict";function bt(e){return e}var eu=O();rr.exports=function(r){if(!r)return bt;r=eu(r);var n=!1,t,u;return function(i){return function f(s,o){if(u)return o(u);s?(u=s,n?i(s,function(l){n?t=o:o(s)}):i(s,function(l){o(s)})):i(null,function(l,a){l?o(l):u?o(u):(n=!0,r(a,function(p,h){n=!1,u?(o(u),t&&t(u)):p?f(p,o):o(null,h)}))})}}}});var re=c((Zi,tr)=>{var ru=O();function nu(e){return e}tr.exports=function(r){return typeof r=="object"&&typeof r.test=="function"?function(n){return r.test(n)}:ru(r)||nu}});var G=c((ji,ur)=>{"use strict";var tu=re();ur.exports=function(r){return r=tu(r),function(n){return function t(u,i){for(var f,s=!0;s;)s=!1,f=!0,n(u,function(o,l){if(!o&&!r(l))return f?s=!0:t(o,i);i(o,l)}),f=!1}}}});var or=c((bi,ir)=>{"use strict";var uu=re(),iu=G();ir.exports=function(r){return r=uu(r),iu(function(n){return!r(n)})}});var fr=c((eo,sr)=>{"use strict";sr.exports=function(r,n){var t=!1;function u(i){t||!n||(t=!0,n(i===!0?null:i))}return function(i){return function(f,s){return f&&u(f),i(f,function(o,l){o?u(o):r&&r(l),s(o,l)})}}}});var cr=c((ro,lr)=>{"use strict";lr.exports=function(r,n){n=n||{};var t=n.last||!1,u=!1;if(typeof r=="number"){t=!0;var i=r;r=function(){return--i}}return function(f){function s(o){f(!0,function(l){t=!1,o(l||!0)})}return function(o,l){u&&!o?t?s(l):l(u):(u=o)?f(u,l):f(null,function(a,p){(u=u||a)?l(u):r(p)?l(null,p):(u=!0,t?l(null,p):s(l))})}}}});var ne=c((no,ar)=>{"use strict";function ou(e){return e}var su=O(),fu=G();ar.exports=function(r,n){r=su(r)||ou;var t={};return fu(function(u){var i=r(u);return t[i]?!!n:(t[i]=!0,!n)})}});var hr=c((to,pr)=>{"use strict";var lu=ne();pr.exports=function(r){return lu(r,!0)}});var vr=c((uo,dr)=>{"use strict";var cu=J(),au=ee();dr.exports=function(){return function(r){var n;return function(t,u){t?n?n(t,function(s){r(s||t,u)}):r(t,u):n?i():f();function i(){n(null,function(s,o){s===!0?f():s?r(!0,function(l){u(s)}):u(null,o)})}function f(){n=null,r(null,function(s,o){if(s)return u(s);Array.isArray(o)||o&&typeof o=="object"?o=cu(o):typeof o!="function"&&(o=au(o)),n=o,i()})}}}}});var yr=c((io,qr)=>{"use strict";qr.exports={map:er(),asyncMap:nr(),filter:G(),filterNot:or(),through:fr(),take:cr(),unique:ne(),nonUnique:hr(),flatten:vr()}});var te=c((oo,xr)=>{"use strict";xr.exports=function e(r){var n=arguments.length;if(typeof r=="function"&&r.length===1){for(var t=new Array(n),u=0;u<n;u++)t[u]=arguments[u];return function(s){if(t==null)throw new TypeError("partial sink should only be called once!");var o=t;switch(t=null,n){case 1:return e(s,o[0]);case 2:return e(s,o[0],o[1]);case 3:return e(s,o[0],o[1],o[2]);case 4:return e(s,o[0],o[1],o[2],o[3]);default:return o.unshift(s),e.apply(null,o)}}}var i=r;i&&typeof i.source=="function"&&(i=i.source);for(var u=1;u<n;u++){var f=arguments[u];typeof f=="function"?i=f(i):f&&typeof f=="object"&&(f.sink(i),i=f.source)}return i}});var M=c((_,gr)=>{"use strict";var wr=Ue(),mr=je(),_r=yr();_=gr.exports=te();_.pull=_;for(var w in wr)_[w]=wr[w];for(var w in _r)_[w]=_r[w];for(var w in mr)_[w]=mr[w]});var ue=c((fo,Er)=>{var so=Er.exports=function(e){(function r(){var n=!0,t=!1,u=!1;do u=!0,n=!1,e.call(this,function(){u?n=!0:r()}),u=!1;while(n)})()}});var Sr=c((lo,kr)=>{var pu=ue();kr.exports=function(e,r){return function(n){var t=[],u,i;function f(l){t.push(l)}e=e||function(l){this.queue(l)},r=r||function(){this.queue(null)};var s={emit:function(l,a){l=="data"&&f(a),l=="end"&&(u=!0,f(null)),l=="error"&&(i=a)},queue:f},o;return function(l,a){if(u=u||l,l)return n(l,function(){if(o){var p=o;o=null,p(l)}a(l)});o=a,pu(function p(h){if(!!o)if(a=o,i)o=null,a(i);else if(t.length){var d=t.shift();o=null,a(d===null,d)}else n(u,function(v,g){if(v&&v!==!0)return i=v,h();if(u=u||v)r.call(s);else if(g!==null&&(e.call(s,g),i||u))return n(i||u,function(){o=null,a(i||u)});h(p)})})}}}});var Pr=c((co,Br)=>{Br.exports=function(){var e=[],r=0;function n(){return e.reduce(function(t,u){return t+u.length},0)}return{length:r,data:this,add:function(t){if(!Buffer.isBuffer(t))throw new Error("data must be a buffer, was: "+JSON.stringify(t));return this.length=r=r+t.length,e.push(t),this},has:function(t){return t==null?r>0:r>=t},get:function(t){var u;if(t==null||t===r){r=0;var i=e;return e=[],i.length==1?i[0]:Buffer.concat(i)}else if(e.length>1&&t<=(u=e[0].length)){var f=e[0].slice(0,t);return t===u?e.shift():e[0]=e[0].slice(t,u),r-=t,f}else if(t<r){for(var s=[],o=0;o+e[0].length<t;){var l=e.shift();o+=l.length,s.push(l)}return o<t&&(s.push(e[0].slice(0,t-o)),e[0]=e[0].slice(t-o,e[0].length),this.length=r=r-t),Buffer.concat(s)}else throw new Error("could not get "+t+" bytes")}}}});var Cr=c((ao,Or)=>{"use strict";var hu=Pr();function du(e){return Number.isFinite(e)}function Ar(e){return typeof e=="function"}function Tr(e,r){return r?function(n,t){var u=setTimeout(function(){e(new Error("pull-reader: read exceeded timeout"),t)},r);e(n,function(i,f){clearTimeout(u),t(i,f)})}:e}Or.exports=function(e){var r=[],n,t,u=!1,i=hu(),f,s,o;function l(){for(;r.length;)if(r[0].length==null&&i.has(1))r.shift().cb(null,i.get());else if(i.has(r[0].length)){var h=r.shift();h.cb(null,i.get(h.length))}else if(f==!0&&r[0].length&&i.length<r[0].length){var d="stream ended with:"+i.length+" but wanted:"+r[0].length;r.shift().cb(new Error(d))}else if(f)r.shift().cb(f);else return!!r.length;return r.length||!i.has(1)||o}function a(){var h=l();h&&!u&&n&&!u&&!s&&(u=!0,t(null,function(d,v){if(u=!1,d)return f=d,l();i.add(v),a()}))}function p(h){if(o){for(;r.length;)r.shift().cb(o);return cb&&cb(o)}t=Tr(h,e),n=h,a()}return p.abort=function(h,d){o=h||!0,n?(u=!0,n(o,function(){for(;r.length;)r.shift().cb(o);d&&d(o)})):d()},p.read=function(h,d,v){if(Ar(d)&&(v=d,d=e),Ar(v))r.push({length:du(h)?h:null,cb:v}),a();else return s=!0,function(g,N){if(u||i.has(1)){if(g)return n(g,N);r.push({length:null,cb:N}),a()}else Tr(n,d)(g,function(It,Rt){N(It,Rt)})}},p}});var Yr=c((E,Nr)=>{var vu=Sr(),qu=Cr(),Ir=0,Rr=1,Lr=2,Ur="GOODBYE",yu=Buffer.isBuffer;function Dr(e){return typeof e=="string"}function Jr(e){var r=Buffer.alloc(9),n=0,t=e.value!==void 0?e.value:e.end;return Dr(e)&&e===Ur?(r.fill(0),[r,null]):(Dr(t)?(n=Rr,t=Buffer.from(t,"utf-8")):yu(t)?n=Ir:(n=Lr,t=Buffer.from(JSON.stringify(t),"utf-8")),n=e.stream<<3|e.end<<2|n,r[0]=n,r.writeUInt32BE(t.length,1),r.writeInt32BE(e.req||0,5),[r,t])}function Fr(e){if(e.length!=9)throw new Error("expected header to be 9 bytes long");var r=e[0],n=e.readUInt32BE(1),t=e.readInt32BE(5);return{req:t,stream:!!(r&8),end:!!(r&4),value:null,length:n,type:r&3}}function Gr(e,r){if(e.length!==r.length)throw new Error("incorrect length, expected:"+r.length+" found:"+e.length);if(Ir===r.type)r.value=e;else if(Rr===r.type)r.value=e.toString();else if(Lr===r.type)r.value=JSON.parse(e.toString());else throw new Error("unknown message type");return r}function Mr(){return vu(function(e){var r=Jr(e);this.queue(r[0]),r[1]!==null&&this.queue(r[1])})}function Hr(){var e=qu(),r=!1;return function(n){return e(n),function(t,u){if(r)return u(!0);if(t)return e.abort(t,u);e.read(9,function(i,f){if(i)return u(i);var s=Fr(f);if(s.length===0)return r=!0,u(null,Ur);e.read(s.length,function(o,l){if(o)return u(o);try{Gr(l,s)}catch(a){return u(a)}u(null,s)})})}}}E=Nr.exports=function(e){return{source:Mr()(e.source),sink:function(r){return e.sink(Hr()(r))}}};E.encodePair=Jr;E.decodeHead=Fr;E.decodeBody=Gr;E.encode=Mr;E.decode=Hr});var Qr=c((po,Kr)=>{function I(e){return e&&(e===!0?!0:{message:e.message,name:e.name,stack:e.stack})}Kr.exports=function(e){return new q(e)};function q(e){this.ended=!1,this.opts=e,this._req_counter=1,this._requests={},this._instreams={},this._outstreams={},this._closecbs=[],this._closing=!1,this._closed=!1,e.close&&this._closecbs.push(e.close)}q.prototype.message=function(e){this.read({req:0,stream:!1,end:!1,value:e})};q.prototype.request=function(e,r){if(this._closing)return r(new Error("parent stream is closing"));var n=this._req_counter++,t=this;this._requests[n]=function(u,i){delete t._requests[n],r(u,i),t._maybedone(u)},this.read({req:n,stream:!1,end:!1,value:e})};q.prototype.stream=function(){if(this._closing)throw new Error("parent stream is closing");var e=this._req_counter++,r=this;return this._outstreams[e]=new R(e,this,function(){delete r._outstreams[e]}),this._outstreams[e]};q.prototype.close=function(e){if(!e)throw new Error("packet-stream.close *must* have callback");if(this._closed)return e();this._closecbs.push(e),this._closing=!0,this._maybedone()};q.prototype.destroy=function(e){e=e||I(e),this.ended=e,this._closing=!0;var r=e===!0?new Error("unexpected end of parent stream"):e,n=0;for(var t in this._requests)n++,this._requests[t](r);for(var t in this._instreams)n++,this._instreams[t].writeEnd=!0,this._instreams[t].destroy(r);for(var t in this._outstreams)n++,this._outstreams[t].writeEnd=!0,this._outstreams[t].destroy(r);n===0&&e===!0&&(r=null),this._maybedone(r)};q.prototype._maybedone=function(e){this._closed||!this._closing||Object.keys(this._requests).length!==0||Object.keys(this._instreams).length!==0||Object.keys(this._outstreams).length!==0||(this._closed=!0,this._closecbs.forEach(function(r){r(e)}),this.read(null,e||!0),this.opts=null,this._closecbs.length=0,this.read=Wr)};function Wr(e){console.error("packet-stream asked to read after closed",e)}q.prototype.read=function(e){console.error("please overwrite read method to do IO",e)};q.prototype.write=function(e,r){this.ended||(r?this.destroy(r):e.req&&!e.stream?this._onrequest(e):e.req&&e.stream?this._onstream(e):this._onmessage(e))};q.prototype._onmessage=function(e){this.opts&&typeof this.opts.message=="function"&&this.opts.message(e.value)};q.prototype._onrequest=function(e){var r=e.req*-1;if(e.req<0)typeof this._requests[r]=="function"&&this._requests[r](e.end?e.value:null,e.end?null:e.value);else if(this.opts&&typeof this.opts.request=="function"){var n=!1,t=this;this.opts.request(e.value,function(i,f){if(n)throw new Error("cb called twice from local api");n=!0,i?t.read({value:I(i),end:!0,req:r}):t.read({value:f,end:!1,req:r}),t._maybedone()})}else{if(this.ended){var u=this.ended===!0?new Error("unexpected end of parent stream"):this.ended;this.read({value:I(u),end:!0,stream:!1,req:r})}else this.read({value:{message:"Unable to handle requests",name:"NO_REQUEST_HANDLER",stack:null},end:!0,stream:!1,req:r});this._maybedone()}};q.prototype._onstream=function(e){if(e.req<0){var r=e.req*-1,n=this._outstreams[r];if(!n)return console.error("no stream for incoming msg",e);e.end?(n.writeEnd&&delete this._outstreams[r],n.readEnd=!0,n.read(null,e.value),this._maybedone()):n.read(e.value)}else{var r=e.req,t=this._instreams[r];if(!t){var u=this;t=this._instreams[r]=new R(r*-1,this,function(){delete u._instreams[r]}),this.opts&&typeof this.opts.stream=="function"&&this.opts.stream(t)}e.end?(t.writeEnd&&delete this._instreams[r],t.readEnd=!0,t.read&&t.read(null,e.value),this._maybedone()):t.read?t.read(e.value):console.error("no .read for stream:",t.id,"dropped:",e)}};function R(e,r,n){this.id=e,this.read=null,this.writeEnd=null,this.readEnd=null,this._ps=r,this._remove=n,this._seq_counter=1}R.prototype.write=function(e,r){if(r){this.writeEnd=r;var n=this._ps;n&&(n.read({req:this.id,stream:!0,end:!0,value:I(r)}),this.readEnd&&this.destroy(r),n._maybedone(r))}else this._ps&&this._ps.read({req:this.id,stream:!0,end:!1,value:e})};R.prototype.end=function(e){this.write(null,I(e||!0))};R.prototype.destroy=function(e){if(this.writeEnd){if(!this.readEnd){this.readEnd=!0;try{this.read&&this.read(null,e)}catch(r){console.error("Exception thrown by PacketStream substream end handler",r),console.error(r.stack)}}}else{if(this.writeEnd=!0,!this.readEnd){this.readEnd=!0;try{this.read(null,e)}catch(r){console.error("Exception thrown by PacketStream substream end handler",r),console.error(r.stack)}}this.write(null,e)}this._ps&&(this._remove(),this._remove=null,this.read=Wr,this._ps=null)}});var zr=c((ho,k)=>{"use strict";var xu=M();function gu(e){var r=!1;return function(n,t){r||(r=!0,e(n,t))}}k.exports=function(e,r){var n=[],t=!1,u,i,f=gu(function(s,o){r&&r(s,o),e=null,r=null,u=null,i&&i(s||!0,function(){})});return e.read=function(s,o){if(t=t||o,u){var l=u;u=null,l(t,s)}else t||n.push(s);t&&f(t!==!0?t:null)},{source:function(s,o){s?(e&&e.write(null,s),o(s),f(s!==!0?s:null)):n.length?o(null,n.shift()):t?o(t):u=o},sink:function(s){if(t)return s(t,function(){}),i=null;i=s,xu.drain(function(o){if(t)return!1;e.write(o)},function(o){e&&!e.writeEnd&&e.write(null,o||!0),f&&f(o)})(s)}}};function $r(e,r){return k.exports(e,function(n){e.writeEnd||e.write(null,n||!0),r&&r(n)})}k.exports.source=function(e){return $r(e).source};k.exports.sink=function(e,r){return $r(e,r).sink};k.exports.duplex=k.exports});var Xr=c((vo,Vr)=>{Vr.exports=function(r){var n,t,u;function i(f){return function(s,o){f(s,function(l,a){if(l&&!u)return u=!0,o(null,r);l&&n?o(l):l?t=o:o(null,a)})}}return i.end=function(){return n=!0,t&&t(n),i},i}});var ie=c((qo,Zr)=>{Zr.exports=function(r,n,t){r(n),t&&t(n===!0?null:n)}});var H=c((yo,jr)=>{"use strict";var br=ie();jr.exports=function(r,n){if(!r)return function(u,i){return u?br(i,u,n):i(!0)};Array.isArray(r)||(r=Object.keys(r).map(function(u){return r[u]}));var t=0;return function(u,i){if(u)return br(i,u,n);t>=r.length?i(!0):i(null,r[t++])}}});var rn=c((xo,en)=>{"use strict";var wu=H();en.exports=function(e){return wu(Object.keys(e))}});var oe=c((go,nn)=>{"use strict";var mu=ie();nn.exports=function(r,n){return function(t,u){if(t)return mu(u,t,n);if(r!=null){var i=r;r=null,u(null,i)}else u(!0)}}});var un=c((wo,tn)=>{"use strict";tn.exports=function(r){var n=0;return r=r||Infinity,function(t,u){if(t)return u&&u(t);if(n>r)return u(!0);u(null,n++)}}});var sn=c((mo,on)=>{"use strict";on.exports=function(r){return r=r||Math.random,function(n,t){return n?t&&t(n):t(null,r())}}});var ln=c((_o,fn)=>{"use strict";fn.exports=function(){return function(r,n){n(!0)}}});var an=c((Eo,cn)=>{"use strict";cn.exports=function(r){return function(n,t){t(r)}}});var hn=c((ko,pn)=>{"use strict";pn.exports={keys:rn(),once:oe(),values:H(),count:un(),infinite:sn(),empty:ln(),error:an()}});var A=c((So,dn)=>{"use strict";dn.exports=function(r,n){var t,u;function i(f){if(t=f,u)return i.abort();(function s(){for(var o=!0,l=!1;o;)if(l=!1,t(null,function(a,p){if(l=!0,a=a||u){if(o=!1,n)n(a===!0?null:a);else if(a&&a!==!0)throw a}else r&&r(p)===!1||u?(o=!1,t(u||!0,n||function(){})):o||s()}),!l){o=!1;return}})()}return i.abort=function(f,s){if(typeof f=="function"&&(s=f,f=!0),u=f||!0,t)return t(u,s||function(){})},i}});var qn=c((Bo,vn)=>{"use strict";var _u=A();vn.exports=function(r){return _u(null,r)}});var xn=c((Po,yn)=>{"use strict";var Eu=A();yn.exports=function(r){return Eu(function(n){console.log(n)},r)}});var T=c((Oo,gn)=>{gn.exports=function(r){return r&&(typeof r=="string"?function(n){return n[r]}:typeof r=="object"&&typeof r.exec=="function"?function(n){var t=r.exec(n);return t&&t[0]}:r)}});var _n=c((Ao,wn)=>{"use strict";function mn(e){return e}var ku=T(),Su=A();wn.exports=function(r,n){var t=!1;return n?r=ku(r)||mn:(n=r,r=mn),Su(function(u){if(r(u))return t=!0,n(null,u),!1},function(u){t||n(u===!0?null:u,null)})}});var Y=c((To,En)=>{"use strict";var Bu=A();En.exports=function(r,n,t){t||(t=n,n=null);var u=Bu(function(i){n=r(n,i)},function(i){t(i,n)});return arguments.length===2?function(i){i(null,function(f,s){if(f)return t(f===!0?null:f);n=s,u(i)})}:u}});var Sn=c((Co,kn)=>{"use strict";var Pu=Y();kn.exports=function(r){return Pu(function(n,t){return n.push(t),n},[],r)}});var Pn=c((No,Bn)=>{"use strict";var Ou=Y();Bn.exports=function(r){return Ou(function(n,t){return n+t},"",r)}});var An=c((Io,On)=>{"use strict";On.exports={drain:A(),onEnd:qn(),log:xn(),find:_n(),reduce:Y(),collect:Sn(),concat:Pn()}});var Cn=c((Ro,Tn)=>{"use strict";function Au(e){return e}var Tu=T();Tn.exports=function(r){return r?(r=Tu(r),function(n){return function(t,u){n(t,function(i,f){try{f=i?null:r(f)}catch(s){return n(s,function(){return u(s)})}u(i,f)})}}):Au}});var In=c((Lo,Nn)=>{"use strict";function Cu(e){return e}var Nu=T();Nn.exports=function(r){if(!r)return Cu;r=Nu(r);var n=!1,t,u;return function(i){return function f(s,o){if(u)return o(u);s?(u=s,n?i(s,function(){n?t=o:o(s)}):i(s,o)):i(null,function(l,a){l?o(l):u?o(u):(n=!0,r(a,function(p,h){n=!1,u?(o(u),t(u)):p?f(p,o):o(null,h)}))})}}}});var se=c((Uo,Rn)=>{var Iu=T();function Ru(e){return e}Rn.exports=function(r){return typeof r=="object"&&typeof r.test=="function"?function(n){return r.test(n)}:Iu(r)||Ru}});var K=c((Do,Ln)=>{"use strict";var Lu=se();Ln.exports=function(r){return r=Lu(r),function(n){return function t(u,i){for(var f,s=!0;s;)s=!1,f=!0,n(u,function(o,l){if(!o&&!r(l))return f?s=!0:t(o,i);i(o,l)}),f=!1}}}});var Dn=c((Jo,Un)=>{"use strict";var Uu=se(),Du=K();Un.exports=function(r){return r=Uu(r),Du(function(n){return!r(n)})}});var Fn=c((Fo,Jn)=>{"use strict";Jn.exports=function(r,n){var t=!1;function u(i){t||!n||(t=!0,n(i===!0?null:i))}return function(i){return function(f,s){return f&&u(f),i(f,function(o,l){o?u(o):r&&r(l),s(o,l)})}}}});var Mn=c((Go,Gn)=>{"use strict";Gn.exports=function(r,n){n=n||{};var t=n.last||!1,u=!1;if(typeof r=="number"){t=!0;var i=r;r=function(){return--i}}return function(f){function s(o){f(!0,function(l){t=!1,o(l||!0)})}return function(o,l){u?t?s(l):l(u):(u=o)?f(u,l):f(null,function(a,p){(u=u||a)?l(u):r(p)?l(null,p):(u=!0,t?l(null,p):s(l))})}}}});var fe=c((Mo,Hn)=>{"use strict";function Ju(e){return e}var Fu=T(),Gu=K();Hn.exports=function(r,n){r=Fu(r)||Ju;var t={};return Gu(function(u){var i=r(u);return t[i]?!!n:(t[i]=!0,!n)})}});var Kn=c((Ho,Yn)=>{"use strict";var Mu=fe();Yn.exports=function(r){return Mu(r,!0)}});var Qn=c((Yo,Wn)=>{"use strict";var Hu=H(),Yu=oe();Wn.exports=function(){return function(r){var n;return function(t,u){t?n?n(t,function(s){r(s||t,u)}):r(t,u):n?i():f();function i(){n(null,function(s,o){s===!0?f():s?r(!0,function(l){u(s)}):u(null,o)})}function f(){n=null,r(null,function(s,o){if(s)return u(s);Array.isArray(o)||o&&typeof o=="object"?o=Hu(o):typeof o!="function"&&(o=Yu(o)),n=o,i()})}}}}});var zn=c((Ko,$n)=>{"use strict";$n.exports={map:Cn(),asyncMap:In(),filter:K(),filterNot:Dn(),through:Fn(),take:Mn(),unique:fe(),nonUnique:Kn(),flatten:Qn()}});var Xn=c((Wo,Vn)=>{"use strict";Vn.exports=function e(r){var n=arguments.length;if(typeof r=="function"&&r.length===1){for(var t=new Array(n),u=0;u<n;u++)t[u]=arguments[u];return function(s){if(t==null)throw new TypeError("partial sink should only be called once!");var o=t;switch(t=null,n){case 1:return e(s,o[0]);case 2:return e(s,o[0],o[1]);case 3:return e(s,o[0],o[1],o[2]);case 4:return e(s,o[0],o[1],o[2],o[3]);default:return o.unshift(s),e.apply(null,o)}}}var i=r;i&&typeof i.source=="function"&&(i=i.source);for(var u=1;u<n;u++){var f=arguments[u];typeof f=="function"?i=f(i):f&&typeof f=="object"&&(f.sink(i),i=f.source)}return i}});var rt=c((L,Zn)=>{"use strict";var jn=hn(),bn=An(),et=zn();L=Zn.exports=Xn();for(var m in jn)L[m]=jn[m];for(var m in et)L[m]=et[m];for(var m in bn)L[m]=bn[m]});var tt=c((Qo,nt)=>{var Ku=Xr(),le=rt();nt.exports=function(e,r){r=r||"GOODBYE";var n=Ku(r);return{source:le(e.source,n),sink:le(le.filter(function(t){if(t!==r)return!0;n.end()}),e.sink)}}});var U=c(y=>{"use strict";var W=M();function Wu(e){return typeof e=="string"}function Qu(e){for(var r in e)return!1;return!0}y.set=function(e,r,n){for(var t,u,i=0;i<r.length;i++){var f=r[i];e[f]=e[f]||{},t=e,u=f,e=e[f]}t[u]=n};y.get=function(e,r){if(Wu(r))return e[r];for(var n,t=0;t<r.length;t++){var u=r[t];if(n=e=e[u],e==null)return e}return n};y.prefix=function(e,r){for(var n,t=0;t<r.length;t++){var u=r[t];if(n=e=e[u],typeof e!="object")return e}return typeof n!="object"?!!n:!1};function $u(e,r){for(var n in r){var t=r[n];e[t]||(e[t]={}),e=e[t]}return e}function zu(e,r){(function n(t,u){var i=r[u];if(t)r.length-1===u?delete t[i]:u<r.length&&n(t[i],u+1);else return;Qu(t[i])&&delete t[i]})(e,0)}function Vu(e,r){for(var n in r)e[n]=r[n];return e}y.mount=function(e,r,n){if(!Array.isArray(r))throw new Error("path must be array of strings");return Vu($u(e,r),n)};y.unmount=function(e,r){return zu(e,r)};function ce(e){return e==="source"}function ae(e){return e==="sink"}function Xu(e){return e==="duplex"}function Zu(e){return e==="sync"}function ju(e){return e==="async"}function bu(e){return Zu(e)||ju(e)}function pe(e){return function(r){r(e||!0,function(){})}}function ut(e){return{source:W.error(e),sink:pe(e)}}y.errorAsStream=function(e,r){return ce(e)?W.error(r):ae(e)?pe(r):ut(r)};y.errorAsStreamOrCb=function(e,r,n){return bu(e)?n(r):ce(e)?W.error(r):ae(e)?pe(r):n(r),ut(r)};y.pipeToStream=function(e,r,n){ce(e)?r(n):ae(e)?n(r):Xu(e)&&W(r,n,r)}});var he=c((Vo,it)=>{function ot(e){if(e.stack&&e.name&&e.message)return e.stack.substring(e.name.length+3+e.message.length).split(`
`);if(e.stack)return e.stack.split(`
`)}function ei(e,r){return e.filter(function(n){return!~r.indexOf(n)})}var zo=it.exports=function(e,r){if(!(e.stack&&e.name&&e.message))return console.error(new Error("stackless error")),e;var n=new Error(r),t=ei(ot(n).slice(1),ot(e)).join(`
`);return n.__proto__=e,n.stack=n.name+": "+n.message+`
`+t+`
  `+e.stack,n}});var pt=c((Xo,st)=>{"use strict";var ri=Qr(),de=zr(),ni=tt(),ft=U(),lt=he();function ti(e){return typeof e=="function"}function ui(e){return e==="source"}function ii(e){return e==="sink"}function oi(e){return e==="duplex"}function si(e){return e==="sync"}function fi(e){return e==="async"}function ct(e){return si(e)||fi(e)}function at(e){return ui(e)||ii(e)||oi(e)}st.exports=function(r,n,t){var u=ri({message:function(){},request:function(f,s){if(!Array.isArray(f.args))return s(new Error("invalid request, args should be array, was:"+JSON.stringify(f)));var o=f.name,l=f.args,a=!1,p=!1;l.push(function(h,d){p=!0,a=!0,s(h,d)});try{r("async",o,l)}catch(h){if(a||p)throw lt(h,"no callback provided to muxrpc async funtion");return s(h)}},stream:function(f){f.read=function(s,o){if(o)return f.write(null,o);var l=s.name,a=s.type,p,h;if(f.read=null,!at(a))return f.write(null,new Error("unsupported stream type:"+a));try{h=r(a,l,s.args)}catch(v){p=v}var d=de[{source:"sink",sink:"source"}[a]||"duplex"](f);return ft.pipeToStream(a,d,p?ft.errorAsStream(a,p):h)}},close:function(f){if(u=null,i.ended=!0,!i.closed&&(i.closed=!0,t)){var s=t;t=null,s(f)}}}),i=ni(de(u,function(){}));return i=n?n(i):i,i.remoteCall=function(f,s,o,l){if(s==="emit")return u.message(o);if(!(ct(f)||at(f)))throw new Error("unsupported type:"+JSON.stringify(f));if(ct(f))return u.request({name:s,args:o},l);var a=u.stream(),p=de[f](a,l);return a.write({name:s,args:o,type:f}),p},i.isOpen=function(){return!u.ended},i.close=function(f,s){return ti(f)&&(s=f,f=!1),u?f?(u.destroy(f),s&&s()):(u.close(function(o){if(s)s(o);else if(o)throw lt(o,"no callback provided for muxrpc close")}),this):s&&s()},i.closed=!1,i}});var dt=c((Zo,ht)=>{"use strict";var li=U(),ci=he();function ai(e){return typeof e=="function"}function pi(e){return e&&typeof e=="object"}function ve(e,r,n,t){for(var u in r)(function(i,f){var s=n?n.concat(i):[i];e[i]=pi(f)?ve({},f,s,t):function(){return t(f,s,[].slice.call(arguments))}})(u,r[u]);return e}function hi(e){if(e)throw ci(e,"callback not provided")}var di=["sync","async"];ht.exports=function(e,r,n,t){e=e||{};function u(i,f,s){var o=ai(s[s.length-1])?s.pop():di.includes(i)?null:hi,l;if(typeof o=="function"){try{l=n(i,f,s,o)}catch(a){return li.errorAsStreamOrCb(i,a,o)}return l}else return new Promise((a,p)=>n(i,f,s,(h,d)=>{h?p(h):a(d)}))}return t?u("async","manifest",[function(i,f){if(i)return t(i);ve(e,f,null,u),t(null,f,e)}]):ve(e,r,null,u),e}});var xt=c((jo,vt)=>{"use strict";var Q=U(),qt=Array.isArray;function $(e){return typeof e=="function"}function yt(e){return qt(e)?e:e.split(".")}function vi(e){return e&&$(e.pre)&&$(e.test)&&$(e.post)}vt.exports=function(e){if(vi(e))return e;if($(e))return{pre:e};var r=null,n={};function t(u){return u.allow?(r={},u.allow.forEach(function(i){Q.set(r,yt(i),!0)})):r=null,u.deny?u.deny.forEach(function(i){Q.set(n,yt(i),!0)}):n={},this}return e&&t(e),t.pre=function(u){if(u=qt(u)?u:[u],r&&!Q.prefix(r,u))return new Error("method:"+u+" is not in list of allowed methods");if(n&&Q.prefix(n,u))return new Error("method:"+u+" is on list of disallowed methods")},t.post=function(){},t.test=function(u){return t.pre(u)},t.get=function(){return{allow:r,deny:n}},t}});var wt=c((bo,gt)=>{var qi=xt(),qe=U();gt.exports=function(r,n,t){t=qi(t);function u(f,s){return f===qe.get(n,s)}function i(f,s,o){if(s==="emit")throw new Error("emit has been removed");if(f==="async"&&u("sync",s)){var l=o.pop(),a;try{a=qe.get(r,s).apply(this,o)}catch(p){return l(p)}return l(null,a)}if(!u(f,s))throw new Error("no "+f+":"+s);return qe.get(r,s).apply(this,o)}return function(f,s,o){var l=t.pre(s,o);if(l)throw l;return i.call(this,f,s,o)}}});var Et=c((es,mt)=>{"use strict";var yi=Yr(),xi=pt(),gi=dt(),wi=wt(),mi=require("events").EventEmitter;function _t(e,r,n,t,u,i,f){var s;typeof e=="function"&&(s=e,e={}),r=r||{},e=e||{};var o=new mi;i||(i=yi);var l,a={_emit:function(d,v){return o&&o._emit(d,v),a},id:t},p=xi(wi(n,r,u).bind(a),i,function(d){if(!o.closed&&(o.closed=!0,o.emit("closed"),l)){var v=l;l=null,v(d)}});if(gi(o,e,function(d,v,g,N){if(p.closed)throw new Error("stream is closed");return p.remoteCall(d,v,g,N)},s),o._emit=o.emit,f){Object.__defineGetter__.call(o,"id",function(){return a.id}),Object.__defineSetter__.call(o,"id",function(d){a.id=d});var h=!0;o.createStream=function(d){if(l=d,h)return h=!1,p;throw new Error("one stream per rpc")}}else o.stream=p;return o.closed=!1,o.close=function(d,v){return p.close(d,v),this},o}mt.exports=function(e,r,n){return arguments.length>3?_t.apply(this,arguments):function(t,u,i){return _t(e,r,t,i,u,n,!0)}}});var Pt=c((x,kt)=>{var rs=te(),_i=ue();function St(e){e.destroy?e.destroy():console.error("warning, stream-to-pull-stream: \nthe wrapped node-stream does not implement `destroy`, \nthis may cause resource leaks.")}function Bt(e,r,n){var t,u=!1,i;function f(){i||(i=!0,n&&n(t===!0?null:t))}function s(){u||(u=!0,l(),t?f():e(t=!0,f))}function o(a){l(),t||e(t=a,f)}function l(){r.on("finish",s),r.removeListener("close",s),r.removeListener("error",o)}r.on("close",s),r.on("finish",s),r.on("error",o),process.nextTick(function(){_i(function(a){e(null,function(p,h){if(t=t||p,p===!0)return r._isStdio?f():r.end();if(t=t||p)return St(r),f(t);if(r._isStdio)r.write(h,function(){a()});else{var d=r.write(h);d===!1?r.once("drain",a):a()}})})})}function Ei(e){var r=!1,n=!1,t;function u(){var i=e.read();if(i!==null&&t){var f=t;t=null,f(null,i)}}return e.on("readable",function(){n=!0,t&&u()}).on("end",function(){r=!0,t&&t(r)}).on("error",function(i){r=i,t&&t(r)}),function(i,f){t=f,r?f(r):n&&u()}}function z(e){var r=[],n=[],t,u=!1,i;function f(){for(;(r.length||t)&&n.length;)n.shift()(r.length?null:t,r.shift());!r.length&&u&&(u=!1,e.resume())}return e.on("data",function(s){r.push(s),f(),r.length&&e.pause&&(u=!0,e.pause())}),e.on("end",function(){t=!0,f()}),e.on("close",function(){t=!0,f()}),e.on("error",function(s){t=s,f()}),function(s,o){if(!o)throw new Error("*must* provide cb");if(s){let a=function(){for(;n.length;)n.shift()(s);o(s)};var l=a;if(t)return a();e.once("close",a),St(e)}else n.push(o),f()}}var ki=z,V=function(e,r){return function(n){return Bt(n,e,r)}},X=function(e){return z(e)};x=kt.exports=function(e,r){return e.writable&&e.write?e.readable?function(n){return Bt(n,e,r),z(e)}:V(e,r):X(e)};x.sink=V;x.source=X;x.read=ki;x.read1=z;x.read2=Ei;x.duplex=function(e,r){return{source:X(e),sink:V(e,r)}};x.transform=function(e){return function(r){var n=X(e);return V(e)(r),n}}});Gt(exports,{logThrough:()=>Ai});var Ot=B(require("net")),At=B(require("http")),Z=B(require("fs")),ye=B(require("child_process")),xe=B(M()),ge=B(require("util")),Si=Et(),C=Pt(),Tt=JSON.parse(process.env.REMOTE_CONTAINERS_SOCKETS),Bi={...Tt.reduce((e,r)=>(e[r]="duplex",e),{}),rpc:"async",ready:"async"},Pi={exec:"async",stdin:"sink",stdout:"source",stderr:"source",exit:"async",terminate:"async",dispose:"async",execToEnd:"async"},S={},Oi=0,j=Si(Bi,Pi)({exec:(e,r)=>{let n=e.cwd,t=e.env?{...process.env,...e.env}:process.env,u=ye.spawn(e.cmd,e.args,{cwd:n,env:t}),i=Oi++;S[i]={process:u,exit:new Promise((f,s)=>{u.once("error",s),u.once("close",(o,l)=>{f({code:o,signal:l})})}),stdin:C.sink(u.stdin),stdout:C.source(u.stdout),stderr:C.source(u.stderr)},r(null,i)},stdin:e=>S[e].stdin,stdout:e=>S[e].stdout,stderr:e=>S[e].stderr,exit:(e,r)=>{S[e].exit.then(n=>r(null,n),r)},terminate:(e,r)=>{S[e].process.kill("SIGKILL"),r()},dispose:(e,r)=>{delete S[e],r()},execToEnd:(e,r)=>{let n=e.cwd,t=e.env?{...process.env,...e.env}:process.env,u=ye.spawn(e.cmd,e.args,{cwd:n,env:t}),i=[];u.stdout.on("data",s=>i.push(s));let f=[];u.stderr.on("data",s=>f.push(s)),u.once("error",r),u.once("close",(s,o)=>{r(null,{stdout:Buffer.concat(i),stderr:Buffer.concat(f),code:s,signal:o})})}});xe.default(C.source(process.stdin),j.createStream(),C.sink(process.stdout));function Ai(e){return function(n,t){e(n,function(u,i){console.error(`logThrough: ${i==null?void 0:i.toString()}`),t(u,i)})}}var Ct=Tt.map(async e=>{try{if(!(await ge.promisify(Z.lstat)(e)).isSocket())return;await ge.promisify(Z.unlink)(e)}catch(n){if(!(n&&n.code==="ENOENT"))throw n}let r=Ot.createServer(n=>{n=C.duplex(n),xe.default(n,j[e](t=>{t&&console.error("Remote to local stream terminated with error:",t)}),n)});return new Promise(n=>r.listen(e,n))}),Nt;Ct.push(new Promise(e=>Nt=e));At.createServer((e,r)=>{let n=[];e.on("data",t=>n.push(t)),e.on("end",()=>{j.rpc(Buffer.concat(n).toString(),(t,u)=>{t?(console.error(t),r.writeHead(500),r.end()):(r.writeHead(200),r.write(u,i=>{i&&console.error(i)}),r.end())})})}).listen(process.env.REMOTE_CONTAINERS_IPC,Nt);Promise.all(Ct).then(()=>j.ready(e=>{e&&console.error(e)})).catch(e=>console.error(e));
//# sourceMappingURL=remoteContainersServer.js.map
